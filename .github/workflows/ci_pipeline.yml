name: CI pipeline

on:
  pull_request:
      branches:
          - main

jobs:
    download-artifacts:
        runs-on: ubuntu-latest
        permissions:
            id-token: write
        steps:
          - run: |
              env
              echo "${{ github.sha }}"
              echo "${{ github.event.pull_request.head.sha }}"
              echo "${{ github.event.pull_request.base.sha }}"
              echo "${{ github.head_ref.sha }}"

          - name: Download dbt artifacts
            uses: pgoslatara/dbt-cloud-download-artifacts-action@v0
            with:
              commit-sha: ${{ github.event.pull_request.head.sha }}
              dbt_cloud_api_token: ${{ secrets.DBT_CLOUD_API_TOKEN }}
              output-dir: target # Optional: Defaults to ".".
              step: 4 # Optional: Defaults to last step in CI job.
              verbose: true # Optional: Defaults to false.

          - run: ls -ahl target
